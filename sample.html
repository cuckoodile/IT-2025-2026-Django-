<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sample API Fetch</title>
    <style>
      * {
        padding: 0;
        border: 0;
        box-sizing: border-box;
      }

      body {
        color: green;
      }
    </style>
  </head>
  <body style="background-color: black; color: green">
    <!-- Input Fields Container -->
    <div
      id="postForm"
      style="
        display: flex;
        flex-direction: column;
        justify-self: center;
        width: 40vw;
        gap: 0.5rem;
        border: dashed cyan 1px;
        padding: 1rem;
      "
    >
      <input type="text" id="first_name" placeholder="first_name" />
      <input type="text" id="last_name" placeholder="last_name" />
      <input type="text" id="middle_name" placeholder="middle_name" />
      <button id="pasa" onclick="postStudent()" style="cursor: pointer">
        IIBIGAY MO NAAA
      </button>
    </div>

    <!-- Students List Container -->
    <div id="root"></div>

    <script>
      let isEditing = false;

      const container = document.getElementById("root");

      async function getStudents() {
        try {
          const response = await fetch("http://127.0.0.1:8000/api/students/");
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const students = await response.json();
          console.log("Students:", students.length);

          container.innerHTML = "";

          // Render each student
          students.forEach((student) => {
            const studentDiv = document.createElement("div");
            studentDiv.style.display = "flex";
            studentDiv.style.justifyContent = "space-between";
            
            data = {
                id: student.id,
                first_name: student.first_name,
                last_name: student.last_name,
                middle_name: student.middle_name,
            };
            console.log("SAAAMPLEEEE: ", data)
            studentDiv.innerHTML = `
              <h1>
                ${student.last_name}, ${student.first_name} ${
              student.middle_name
                ? student.middle_name[0].toUpperCase() + "."
                : ""
            }
              </h1>
              <div style="display:flex; align-items: center;">
                <button onclick="{console.log('Checking id: ${student.id}\\ndata: ${Object.values(student)}'), openEditStudent(${data})}" style="cursor: pointer; margin-right: 10px;">
                  Edit
                </button>
                <button onclick="deleteStudent('${
                  student.id
                }')" style="cursor: pointer;">
                  Delete
                </button>
              </div>
            `;
            container.appendChild(studentDiv);
          });
        } catch (error) {
          console.error("Error fetching students:", error);
          container.innerHTML = "<p>Error loading students.</p>";
        }
      }

      async function postStudent() {
        const first_name = document.getElementById("first_name").value;
        const last_name = document.getElementById("last_name").value;
        const middle_name = document.getElementById("middle_name").value;

        const data = {
          first_name,
          last_name,
          middle_name,
        };

        try {
          const response = await fetch("http://127.0.0.1:8000/api/students/", {
            method: "POST",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          console.log("Student posted:", await response.json());
          // Clear form inputs
          document.getElementById("first_name").value = "";
          document.getElementById("last_name").value = "";
          document.getElementById("middle_name").value = "";
          // Refresh student list
          await getStudents();
        } catch (error) {
          console.error("Error posting student:", error);
        }
      }

      async function deleteStudent(id) {
        try {
          const response = await fetch(
            `http://127.0.0.1:8000/api/student/${id}/`,
            {
              method: "DELETE",
              headers: {
                Accept: "application/json",
              },
            }
          );
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          console.log(`Student ${id} deleted`);
          // Refresh student list
          await getStudents();
        } catch (error) {
          console.error("Error deleting student:", error);
        }
      }

      async function openEditStudent({data}) {
        console.log(`Editing id: ${data?.id}\\ndata: ${data}`);
        isEditing = true;
        let first_name_input = document.getElementById("first_name");
        let middle_name_input = document.getElementById("middle_name");
        let last_name_input = document.getElementById("last_name");
        first_name_input.value = data?.first_name;
        middle_name_input.value = data?.middle_name;
        last_name_input.value = data?.last_name;
      }

      async function editStudent(id, newData) {
        try {
          print(`Editing id: ${id} /t data: ${data}`);

          isEditing = true;

          let first_name_input = document.getElementById("first_name");
          let middle_name_input = document.getElementById("middle_name");
          let last_name_input = document.getElementById("last_name");

          first_name_input.value = newData.first_name;
          middle_name_input.value = newData.middle_name;
          last_name_input.value = newData.last_name;

          const response = await fetch(
            `http://127.0.0.1:8000/api/student/${id}/`,
            {
              method: "DELETE",
              headers: {
                Accept: "application/json",
              },
            }
          );
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          console.log(`Student ${id} deleted`);
          // Refresh student list
          await getStudents();
        } catch (error) {
          console.error("Error deleting student:", error);
        }
      }

      function printStudent(id, name) {
        console.log(`Student ID: ${id}, Name: ${name}`);
      }

      function print(text) {
        console.log(text);
      }

      // Initial fetch
      getStudents();
    </script>
  </body>
</html>
